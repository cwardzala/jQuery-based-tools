dojo.require("dojo.NodeList-traverse");

var o = {
	scp: ".tabs ",
	mode: "tabs",
	defaultTab: 1
}

function handle_menu_click(click_event){
	// We don't want the link to act normally
	click_event.preventDefault();
	// assign variable for href
    var href = dojo.query(this).attr('href')[0].replace("#","");
	// if already active or href equals #blank dont change tab, just return
	var parent = dojo.query(this).parent('li')[0];
   	if (dojo.hasClass(parent,'active') || href === "#blank" || dojo.hasClass(parent,'disabled')) {return;}
	dojo.query(o.scp+'.active').removeClass('active');
	dojo.query(this).parents('li').addClass('active');
	dojo.query(o.scp+'.open').addClass('hidden').removeClass('open');
	dojo.query(o.scp+'a[name='+href+']').parents('.target').removeClass('hidden').addClass('open');
}

function dojoTabsInit(options){
	dojo.mixin(o,options);
	var tabi = o.defaultTab-1;
	// bind the click function
	dojo.query(o.scp+'.trigger a').connect('onclick',handle_menu_click);
	// hide all targets except the default open
	dojo.query(o.scp+'.target').forEach(function(item, i){
		dojo.query(o.scp+'.topLink').addClass('hidden');
		if (i !== tabi) {
			dojo.addClass(item,'hidden');
		} else {
			dojo.addClass(item,'open');
			dojo.addClass(dojo.query(o.scp+'.trigger')[tabi],'active');
		}
	});
}