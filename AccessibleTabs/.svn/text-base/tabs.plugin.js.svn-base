(function($){  
	$.fn.atabs = function(options) {
		if (!options){var defaultTabIndex = 0; var mode = "tabs";}
		else {var defaultTabIndex = options.defaultTab - 1; var mode=options.mode;}
		var me = $(this);
		
		function tab_click(click_event){
			/* We don't want the link to act normally */
			click_event.preventDefault();
			/* assign variable for href */
		    var href = $(this).attr('href').replace("#", "");
			/* if already active or href equals #blank dont change tab, just return */
		   	if ($(this).parents('li').hasClass('active') || href === "#blank" || $(this).parents('li').hasClass('disabled')) {return;}
			me.find('.active').removeClass('active');
			$(this).parent('li').addClass('active');
			me.find('.open').addClass('hidden').removeClass('open');
			$('a[name='+href+']').parent('.target').removeClass('hidden').addClass('open');
		}
		
		function accordion_click(click_event){
			/* We don't want the link to act normally */
			click_event.preventDefault();
			/* assign variable for href */
		    var href = $(this).attr('href').replace("#", "");
			/* if already active or href equals #blank dont change tab, just return */
		   	if (href === "#blank" || $(this).parents('li').hasClass('disabled')) {return;}
			$(this).parents('li').toggleClass("active");
			if ($(this).html() == "Expand"){$(this).html("Collapse")}
			else if ($(this).html() == "Collapse"){$(this).html("Expand")}
			$('a[name='+href+']').parent('.target').toggleClass("hidden");
		}
		
		switch(mode)
		{
			case "tabs":
				me.find('.trigger').find('a').unbind('click').bind('click', tab_click);
			break;
			case "accordion":
				defaultTabIndex = -1;
				me.find('.trigger').find('a').unbind('click').bind('click', accordion_click);
			break;
			default:
				defaultTabIndex = 0;
				me.find('.trigger').find('a').unbind('click').bind('click', tab_click);
			break;
		}
		
		// hide all targets except the default open
		me.find('.target').each(function(){
			$(this).find('.topLink').addClass('hidden');
			if (me.find('.target').index(this) != defaultTabIndex) {
				$(this).addClass('hidden');
			} else if (me.find('.target').index(this) == defaultTabIndex){
				$(this).addClass('open');
				me.find('.trigger').eq(defaultTabIndex).addClass('active');
			}
		});
	};
})(jQuery);